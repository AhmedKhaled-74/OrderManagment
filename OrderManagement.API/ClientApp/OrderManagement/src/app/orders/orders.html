<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">Order History</h1>
    <button class="btn btn-primary" (click)="loadOrders()">Refresh</button>
  </div>

  <!-- Loading spinner -->
  <ng-container *ngIf="orders$ | async as orders; else loading">
    <!-- Empty State -->
    <div *ngIf="orders.length === 0" class="text-center py-5">
      <i class="bi bi-cart-x fs-1 text-muted"></i>
      <h3 class="mt-3">No orders found</h3>
      <p class="text-muted">You haven't placed any orders yet.</p>
    </div>

    <!-- Orders List -->
    <div *ngIf="orders.length > 0">
      <div class="accordion" id="ordersAccordion">
        <div
          *ngFor="let order of orders; let i = index"
          class="accordion-item mb-3 border-0 shadow-sm rounded-3"
        >
          <h2 class="accordion-header" [id]="'heading' + i">
            <button
              class="accordion-button collapsed py-3"
              type="button"
              data-bs-toggle="collapse"
              [attr.data-bs-target]="'#collapse' + i"
              aria-expanded="false"
              [attr.aria-controls]="'collapse' + i"
            >
              <div class="d-flex flex-column flex-md-row w-100">
                <div class="me-md-4 mb-2 mb-md-0 w-md-lg">
                  <span class="badge bg-light text-dark me-2 col-md-6">
                    #{{ order.orderNumber }}
                  </span>
                  <span class="text-muted small col-6">
                    {{ order.orderDate | date : "yyyy-MM-dd hh:mm a" }}
                  </span>
                </div>
                <div class="me-md-4">
                  <span class="fw-bold">{{ order.customerName }}</span>
                </div>
                <div class="ms-md-auto">
                  <span class="fw-bold text-success">
                    ${{ order.totalAmount | number : "1.2-2" }}
                  </span>
                </div>
              </div>
            </button>
          </h2>
          <div
            [id]="'collapse' + i"
            class="accordion-collapse collapse"
            [attr.aria-labelledby]="'heading' + i"
            data-bs-parent="#ordersAccordion"
          >
            <div class="accordion-body pt-3">
              <h5 class="mb-3">Order Items</h5>
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th scope="col">Item</th>
                      <th scope="col" class="text-end">Quantity</th>
                      <th scope="col" class="text-end">Unit Price</th>
                      <th scope="col" class="text-end">Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of order.orderItems">
                      <td>{{ item.itemName }}</td>
                      <td class="text-end">{{ item.quantity }}</td>
                      <td class="text-end">
                        ${{ item.unitPrice | number : "1.2-2" }}
                      </td>
                      <td class="text-end">
                        ${{ item.quantity * item.unitPrice | number : "1.2-2" }}
                      </td>
                    </tr>
                  </tbody>
                  <tfoot>
                    <tr>
                      <td colspan="3" class="fw-bold text-end">Order Total:</td>
                      <td class="fw-bold text-end">
                        ${{ order.totalAmount | number : "1.2-2" }}
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>

              <div class="d-flex justify-content-end mt-3">
                <button
                  class="btn btn-outline-primary"
                  (click)="viewInvoice(order.orderId)"
                >
                  <fa-icon [icon]="faReceipt"></fa-icon> View Invoice
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Loading fallback -->
  <ng-template #loading>
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading orders...</p>
    </div>
  </ng-template>
</div>
